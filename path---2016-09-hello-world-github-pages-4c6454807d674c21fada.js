webpackJsonp([0xa955c2ab059],{400:function(n,s){n.exports={pathContext:{post:{images:{blurUp:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAAAo0lEQVQY02P4jw1cunQpLCSkpqqquqrK29PzzZs3WJUxYBVdsXy5orw8HG3ZsoUEzY0NDdtm9T7cufTx3hUbp7R3d3URpfnXr1/v3r3bv3//lpk9746sfX90/fbZvXv37gUKAqWIsnn/ocMHDh22tjC3NDN98eLFfxyAAZfE8dNn7R0c3Tw8X3/8TJrml9//TD79MKy0NbKis//43Qeff2NVBgBlu3E3u+7kDwAAAABJRU5ErkJggg=="},share:{src:"/static/github-octocat-4ee960190d0f89f49bede6b7f8769d85-f5537.jpg"},heroPreviewLG:{src:"/static/github-octocat-4ee960190d0f89f49bede6b7f8769d85-294b1.webp"},heroPreviewMD:{src:"/static/github-octocat-4ee960190d0f89f49bede6b7f8769d85-d8cc9.webp"},heroPreviewSM:{src:"/static/github-octocat-4ee960190d0f89f49bede6b7f8769d85-c14dc.webp"},heroPreviewXS:{src:"/static/github-octocat-4ee960190d0f89f49bede6b7f8769d85-227ee.webp"},mediumPreview:{src:"/static/github-octocat-4ee960190d0f89f49bede6b7f8769d85-ce211.webp"},smallPreview:{src:"/static/github-octocat-4ee960190d0f89f49bede6b7f8769d85-051c1.webp"}},excerpt:"Ave $USER! В последнее время стали очень популярны статические сайты, а в том числе и статические блоги. Даже меня не обшло…",id:"/Users/ivan/projects/gatsby-blog/src/pages/2016/09/hello-world-github-pages/index.md absPath of file >>> MarkdownRemark",slug:"/2016/09/hello-world-github-pages",permalink:"https://potofcode.com/2016/09/hello-world-github-pages/",html:'<p>Ave $USER!</p>\n<p>В последнее время стали очень популярны статические сайты, а в том числе и статические блоги. Даже меня не обшло стороной это веяние и\nподдавшись искушению и всеобщему хайпу, я перевел свой блог в ряды статических сайтов. Хостится он на GitHub с Custom Domain и проксируется\nчерез Cloud Flare, раздавая трафик по HTTPS.</p>\n<h3>Подготовка</h3>\n<h4>Cloud Flare</h4>\n<p>Регистрируемся на <a href="https://cloudflare.com">Cloud Flare</a> и добавляем свое доменное имя, например <code>my-cool-blog.com</code></p>\n<div class="gallery">\n  \n  <a class="gatsby-resp-image-link" href="/static/cloudflare-step-1-e12c836a773bab981954530381657ac2-8af6d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; z-index: 1; max-width: 976px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 43.852459016393446%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAArElEQVQoz53O4Q6CIBAH8Hv4nqNn6QH6ljBta+YQ5iybyYEMsSIxV2tz2e/DcTv43wBKabSLCCGMsbIsT0sAz3POfcl9WAgROv4kwmRmI5wHRVForfuFAJXyMTVARN/7aq29/wDquvavW61DzK+QUiLK18Jx7odqhOEwxsAUcM7dFoLpz0HXdW5W73pjccvWm8MKCKVpmh4/ZVm2T5Ikjr+v3kFVXZpr0+r2Dw/dof17coh9VAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;" alt="cloudflare step 1" title="" src="/static/cloudflare-step-1-e12c836a773bab981954530381657ac2-8af6d.png" srcset="/static/cloudflare-step-1-e12c836a773bab981954530381657ac2-bf693.png 245w,\n/static/cloudflare-step-1-e12c836a773bab981954530381657ac2-ace74.png 490w,\n/static/cloudflare-step-1-e12c836a773bab981954530381657ac2-8af6d.png 976w" sizes="(max-width: 976px) 100vw, 976px">\n    </span>\n  </span>\n  \n  </a>\n    \n</div>  \n<p>жмем <em>Begin Scan</em> и ждем окончания процесса. После окончания сканирования жмем продолжить, перед вами будет экран со всеми записями\nдомена, его можно пропустить (позже мы вернемся к нему) и нажать продолжить. Выбираем план подписки для данного домена и жмем продолжить.\nПоявится экран с NS записями, где необходимо скопировать адреса:</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>dana.ns.cloudflare.com\ntodd.ns.cloudflare.com</code></pre>\n      </div>\n<p>и заменить ими ваши текущие NS записи.</p>\n<p>Все должно быстро обновиться и теперь идем в раздел <em>Crypto</em> и выставляем SSL значение Flexible.</p>\n<p>Переходим в раздел <code>Page Rules</code> и создаем правило для URL <code>http://*my-cool-blog.com/*</code> жмем <em>Add Settings</em> и выбираем <em>Always use HTTPS</em>.</p>\n<p>И наконец переходим во вкладку <code>DNS</code> и добавляем 2 A-записи для IP адресов: 192.30.252.153 и 192.30.252.154.\nЭто адреса GitHub серверов и жмем на тучки, что бы выставить статус <em>DNS and HTTP proxy(CDN)</em>.</p>\n<h4>GitHub</h4>\n<p>Создаем одноименный аккаунт на <a href="https://github.com">GitHub</a> <code>my-cool-blog</code>.\nДалее создаем репозиторий с именем <code>my-cool-blog.github.io</code> и переходим в настройки.\nТам в группе <em>GitHub Pages</em> находим поле <em>Custom Domain</em> и вводим свое доменное имя.</p>\n<h3>Проверка</h3>\n<p>Выполняем</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">mkdir</span> my-cool-blog\n<span class="token function">cd</span> my-cool-blog\n<span class="token function">git</span> clone https://github.com/my-cool-blog/my-cool-blog.github.io.git <span class="token keyword">.</span>\n</code></pre>\n      </div>\n<p>создаем файл <code>index.html</code></p>\n<div class="gatsby-highlight">\n      <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>My Cool Blog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>My Cool Blog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>\n</code></pre>\n      </div>\n<p>Выполняем</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">git</span> add --all\n<span class="token function">git</span> ci -am <span class="token string">"my first post"</span>\n<span class="token function">git</span> push\n</code></pre>\n      </div>\n<p>и переходим по URL <code>http://my-cool.blog.com</code>.</p>\n<p>Должен произойти редирект на <code>https://my-cool-blog.com</code>.</p>\n<h3>Профит</h3>\n<p>Качественный бесплатный хостинг, для статического сайта с HTTPS, DDoS защитой и самое главное - это версионность, так как все хостится на GitHub.</p>',color:"rgba(41, 29, 29, 0.8)",title:"Как создать свой сайт на GitHub с Custom Domain и HTTPS",description:"Подробное описание процесса создания сайта на GitHub с Custom Domain и HTTPS",category:"кодинг",tags:["hello world","github"],date:"2016-09-25T00:00:00.000Z",type:null},recommended:[{images:{blurUp:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVQY02Nw97QDIjcPW1IRUBcDfs3RsSF49BPQvGnzusysRAKaY+NC9+/f093T5h1gWzzZPrPZ3tvXadHiuc+fP8vKTpo+Y9LWrRtDQr1D4u3Ckuz8w+08fJA0A6VnzZ56586t2Dy7icccgCgtO/rCxXOnTp/IzUt9+uzRzEWdsfGhiaX2Oe32Ycl2KH4uKMqMjA5sbqn1DbatmGOf12PvH+i6Y8eWPXt3BgZ7LFu+cO68GUANEel2kRl2fmF2RPkZPwIAZi2QqNzjmmsAAAAASUVORK5CYII="},share:{src:"/static/nodejs-b36310abf764c91568d26a134e70d9fa-f5537.jpg"},heroPreviewLG:{src:"/static/nodejs-b36310abf764c91568d26a134e70d9fa-294b1.webp"},heroPreviewMD:{src:"/static/nodejs-b36310abf764c91568d26a134e70d9fa-d8cc9.webp"},heroPreviewSM:{src:"/static/nodejs-b36310abf764c91568d26a134e70d9fa-c14dc.webp"},heroPreviewXS:{src:"/static/nodejs-b36310abf764c91568d26a134e70d9fa-227ee.webp"},mediumPreview:{src:"/static/nodejs-b36310abf764c91568d26a134e70d9fa-ce211.webp"},smallPreview:{src:"/static/nodejs-b36310abf764c91568d26a134e70d9fa-051c1.webp"}},excerpt:"Ave $USER! Node.JS - это платформа для выполнения JavaScript основаная на движке V8. \nВ этой статье мы установим node.js и…",id:"/Users/ivan/projects/gatsby-blog/src/pages/2017/09/hello-world-node-js/index.md absPath of file >>> MarkdownRemark",slug:"/2017/09/hello-world-node-js",permalink:"https://potofcode.com/2017/09/hello-world-node-js/",html:'<p>Ave $USER!</p>\n<p>Node.JS - это платформа для выполнения JavaScript основаная на движке V8.\nВ этой статье мы установим node.js и напишем простой веб-сервис,\nкоторый будет показывать топ 10 новостей с Hacker News.</p>\n<h3>Установка</h3>\n<h4>Windows</h4>\n<p>Для установки нужно перейти на сайт <a href="https://nodejs.org/en/">nodejs.org</a> скачать и установить.</p>\n<blockquote>\n<p><strong>Примечание:</strong>\nЕсли вы используете <code>Visual Studio 2015</code>, установите переменную окружения <code>GYP_MSVS_VERSION=2015</code>, что бы собирать модули Node JS с помощью <code>Visual Studio 2015</code></p>\n</blockquote>\n<h4>Ubuntu</h4>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code>curl -sL https://deb.nodesource.com/setup_8.x <span class="token operator">|</span> <span class="token function">sudo</span> -E <span class="token function">bash</span> -\n<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y nodejs\n</code></pre>\n      </div>\n<h4>MacOS</h4>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code>brew <span class="token function">install</span> node\n</code></pre>\n      </div>\n<h3>Проверка</h3>\n<p>Вместе с node.js будет установлен менеджер пакетов <code>npm</code>. Что бы проверить версию <code>node</code> и <code>npm</code> введем команды</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code>node -v\n<span class="token function">npm</span> -v\n</code></pre>\n      </div>\n<p>На момент написания статьи я использую <code>node</code> версии <code>8.4.0</code>. Давайте запустим простейший http сервер на node.js.</p>\n<h3>Создание проекта</h3>\n<p>У меня все проекты находятся по пути <code>~/projects/JavaScript</code>.\nОткроем консоль, создадим директорию для нашего проекта <code>hacker-blog</code> и перейдем в нее.\nСначала нам нужно инициализировать проект командой <code>npm init -y</code>.\nВ результате должен появиться файл <code>package.json</code>. Откроем его и изменим секцию <code>scripts</code>:</p>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code>...\n  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"nodemon index.js"</span>\n  <span class="token punctuation">}</span>\n...\n</code></pre>\n      </div>\n<p>Далее установим необходимые модули с помощью следующей команды:</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save express isomorphic-fetch nodemon\n</code></pre>\n      </div>\n<p>Немного о модулях:</p>\n<ul>\n<li>express - <a href="https://expressjs.com/">мини веб-фреймворк</a>, с очень удобным API</li>\n<li>isomorphic-fetch - модуль позволяет использовать <a href="https://developer.mozilla.org/ru/docs/Web/API/Fetch_API">Fetch API</a> на стороне сервера</li>\n<li>nodemon - модуль позволяет автоматически перезапускать скрипт при его изменении </li>\n</ul>\n<p>Сначала создадим шаблон для нашего сайта в обычном <code>index.html</code> файле</p>\n<div class="gatsby-highlight">\n      <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Top 10 Hacker News stories<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">\n    <span class="token selector">html, body</span> <span class="token punctuation">{</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">min-height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> #f6f6ef<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.title</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> #f60<span class="token punctuation">;</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>\n      <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token selector">.stories</span> <span class="token punctuation">{</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>\n      <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.story</span> <span class="token punctuation">{</span>\n      <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token selector">.story__details</span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> #888\n    <span class="token punctuation">}</span>\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Top 10 Hacker News<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stories<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token comment">&lt;!--STORIES--></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>\n</code></pre>\n      </div>\n<p>Здесь все просто, в списке есть комментарий <code>&#x3C;!--STORIES--></code>, который будем использовать как метку, куда поместить наши новости.\nСтили можете изменить на свой вкус и цвет.</p>\n<p>Теперь создадим файл <code>service.js</code> где будут функции вызова API Hacker News:</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'isomorphic-fetch\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// Т.к. у нас установлен node 8+ то можем использовать async/await, </span>\n<span class="token comment">// что делает код более читабельным и линейным, нежели лапша из `Promise.then`.</span>\n\n<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getTopStoriesIds</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token comment">// Здесь используется URL `https://hacker-news.firebaseio.com/v0/topstories.json?print=pretty`,</span>\n<span class="token comment">// который возвращает массив из числовых значений топ новостей, где мы получам `count` первых значений.</span>\n\n  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">\'https://hacker-news.firebaseio.com/v0/topstories.json?print=pretty\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> ids <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> ids<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchTopStories</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token comment">// Здесь мы получем информацию о каждой новости по ее номеру </span>\n<span class="token comment">// через URL `https://hacker-news.firebaseio.com/v0/item/${id}.json`.</span>\n\n  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>ids<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> id <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`https://hacker-news.firebaseio.com/v0/item/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  getTopStoriesIds<span class="token punctuation">,</span>\n  fetchTopStories<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>И наконец создадим файл <code>index.js</code>, это и будет наш сервер:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token comment">// Импортируем установленные модули</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> Express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'express\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">Express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// Импортируем наш сервис</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> getTopStoriesIds<span class="token punctuation">,</span> fetchTopStories <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./services\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// Записываем шаблон в строку</span>\n<span class="token keyword">const</span> template <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">\'./index.html\'</span><span class="token punctuation">,</span> <span class="token string">\'utf8\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// Функция для отрисовки новости</span>\n<span class="token keyword">function</span> <span class="token function">renderStory</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">,</span> title<span class="token punctuation">,</span> by<span class="token punctuation">,</span> time <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`\n&lt;li class="story">\n  &lt;a href="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" class="story" target="_blank"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/a>\n  &lt;div class="story__details">by </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>by<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>time <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div>\n&lt;/li>\n`</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// Задаем обрабатчик HTTP запроса</span>\napp<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'/\'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token comment">// Ожидаем получение топ 10 новостей</span>\n    <span class="token keyword">const</span> topIds <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getTopStoriesIds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// Ожидаем получение информации о новостях</span>\n    <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchTopStories</span><span class="token punctuation">(</span>topIds<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// Отрисовываем их в строки</span>\n    <span class="token keyword">const</span> stories <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>renderStory<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// Задаем время актуальности запроса</span>\n    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">\'Cache-Control\'</span><span class="token punctuation">,</span> <span class="token string">\'public, max-age=100\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">\'Expires\'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    \n    <span class="token comment">// Заменяем нашу метку на строки и отправляем ответ</span>\n    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'&lt;!--STORIES-->\'</span><span class="token punctuation">,</span> stories<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'\\n\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    \n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// Обрабатываем ошибку, если что-то не так</span>\n    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">\'Something broke!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_PORT <span class="token operator">||</span> <span class="token number">9191</span><span class="token punctuation">;</span>\n\n<span class="token comment">// Запускаем сервер</span>\napp<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Served from http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  \n</code></pre>\n      </div>\n<h3>Запуск</h3>\n<p>Теперь запустим наш сервер командой:</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> start\n</code></pre>\n      </div>\n<p>Перейдя по адресу <a href="http://127.0.0.1:9191">127.0.0.1:9191</a> мы увидим нашу страницу:</p>\n<div class="gallery">\n  \n  <a class="gatsby-resp-image-link" href="/static/result-905384fc0b7743bab771ef2893a36f3d-56888.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; z-index: 1; max-width: 980px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7ElEQVQ4y+2RQW7CMBBFfdYcqKoqcYDehCULCAI7EJMU6pDINhapQCVddPHrGSR2SCRdVeri68uW/fQ8Ft+vCe6lHCVYPCeYPl179ZLgbXT/PEWcygm8GsPJMXdnZviqUk4X82nS2/qRiBBqbDYKeb5EUWRomi0ul5bTdR+9I6x9R5bNodScW8oU6/UCh8N+GJAM81xGyBJluWLLoXYM9L6KVjM2I2Bdb+H9HrRvrUEITX9DrRUbai2j4RXqnGEwdR9jQRY0O/qU3U7DmOIGcq6Ks6y5HwaezwFkSU9rW4vj0f5uhkMv/gP/EPAH51Fgl8eicBEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;" alt="result" title="" src="/static/result-905384fc0b7743bab771ef2893a36f3d-70dbf.png" srcset="/static/result-905384fc0b7743bab771ef2893a36f3d-5dcff.png 245w,\n/static/result-905384fc0b7743bab771ef2893a36f3d-4d433.png 490w,\n/static/result-905384fc0b7743bab771ef2893a36f3d-70dbf.png 980w,\n/static/result-905384fc0b7743bab771ef2893a36f3d-56888.png 1024w" sizes="(max-width: 980px) 100vw, 980px">\n    </span>\n  </span>\n  \n  </a>\n    \n</div>\n<p><a href="https://github.com/potofcode/hacker-blog.git" target="_github">Исходники</a></p>',
color:"rgba(70, 72, 62, 0.9)",title:"Hello World. Простейший Node JS Hacker News сервер",description:"Hello World. Установка и запуск простейшего приложения на Node JS показывающее новости с Hacker News",category:"кодинг",tags:["hello world","node js"],date:"2017-09-01T00:00:00.000Z",type:null},{images:{blurUp:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAUUlEQVQY02O46OpENmKggWY35wcNtVfDQ4Dosp83aZrvlhbfr62+W1L4sL31yaSJ1yJCSdB8Iyn+QVPDg8b6Z7Nn3a+tuuLvQ46f8biZ0gADACkGwpDM1C33AAAAAElFTkSuQmCC"},share:{src:"/static/gulp-76e224ba97d2ae7c071bf8b1823e59db-f5537.jpg"},heroPreviewLG:{src:"/static/gulp-76e224ba97d2ae7c071bf8b1823e59db-294b1.webp"},heroPreviewMD:{src:"/static/gulp-76e224ba97d2ae7c071bf8b1823e59db-d8cc9.webp"},heroPreviewSM:{src:"/static/gulp-76e224ba97d2ae7c071bf8b1823e59db-c14dc.webp"},heroPreviewXS:{src:"/static/gulp-76e224ba97d2ae7c071bf8b1823e59db-227ee.webp"},mediumPreview:{src:"/static/gulp-76e224ba97d2ae7c071bf8b1823e59db-ce211.webp"},smallPreview:{src:"/static/gulp-76e224ba97d2ae7c071bf8b1823e59db-051c1.webp"}},excerpt:"Ave $USER! В этом Hello World я расскажу как использовать инструмент разработки Gulp в своих проектах.\nРассмотрим установку…",id:"/Users/ivan/projects/gatsby-blog/src/pages/2016/09/hello-world-gulp/index.md absPath of file >>> MarkdownRemark",slug:"/2016/09/hello-world-gulp",permalink:"https://potofcode.com/2016/09/hello-world-gulp/",html:'<p>Ave $USER!</p>\n<p>В этом Hello World я расскажу как использовать инструмент разработки Gulp в своих проектах.\nРассмотрим установку, настройку и примеры использования. Хочешь разобраться с Gulp, читай далее.</p>\n<h3>Для чего нужен Gulp?</h3>\n<p>Gulp - это планировщик задач. Что это значит?\nНапример, у нас есть директория <code>src</code> где ведется разработка проекта и директория <code>build</code>, куда проект собирается и\nнеобходимо выполнить следующие задачи при сборке проекта:</p>\n<ul>\n<li>очистить директорию сборки</li>\n<li>скопировать все <code>css</code> файлы, кроме <code>*.dev.css</code>, в <code>css</code> директорию сборки, после ее очистки</li>\n<li>скопировать все <code>js</code> файлы, кроме <code>*.dev.js</code>, в <code>js</code> директорию сборки, после ее очистки</li>\n<li>скопировать все картинки из директории <code>images</code>, в <code>images</code> директорию сборки, после ее очистки</li>\n<li>скопировать все <code>html</code>, в корень директории сборки, после ее очистки</li>\n</ul>\n<p>Все эти задачи можно сконфигурировать для Gulp в очень удобной и понятной форме и выполнить их в заданной последовательности.</p>\n<h3>Установка и настройка Gulp</h3>\n<p>Что бы установить, настроить, а позже исползовать Gulp, необходимо установить его глобально</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> i -g gulp\n</code></pre>\n      </div>\n<p>и локально в проект</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> i --save-dev gulp\n</code></pre>\n      </div>\n<p>Gulp использует конфигурационный файл <code>gulpfile.js</code>, вот его примерный шаблон</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">const</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'task-1\'</span><span class="token punctuation">,</span> completeCallback <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// Some task-1 code</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">//await while task-1 finished</span>\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'task-2\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'task-1\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> completeCallback <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// Some task-2 code</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'task-1\'</span><span class="token punctuation">,</span> <span class="token string">\'task-2\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>Для выполнения конкретной задачи, необходимо выполнить команду:</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code>gulp <span class="token punctuation">[</span>task-name<span class="token punctuation">]</span>\n</code></pre>\n      </div>\n<p>Для выполнения задачи по умолчанию, [task-name] не указывается.</p>\n<h3>От теории к практике</h3>\n<p>Давайте рассмотрим на примере задач, которые я привел выше. Для этого установим дополнительный модуль,\nдля удаления файлов по glob маске</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> i --save-dev del\n</code></pre>\n      </div>\n<p>Конфигурационный файл <code>gulpfile.js</code> примет следующий вид</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code><span class="token keyword">const</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> del <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'del\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// Build directory clean task</span>\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'clean\'</span><span class="token punctuation">,</span> cb <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token string">\'./build\'</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// Copy css files to css build directory except *.dev.css after clean task</span>\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'css-copy\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'clean\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'./src/css/**/*.css\'</span><span class="token punctuation">,</span> <span class="token string">\'!./src/css/**/*.dev.css\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./build/css\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// Copy js files to js build directory except *.dev.js after clean task</span>\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'js-copy\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'clean\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'./src/js/**/*.js\'</span><span class="token punctuation">,</span> <span class="token string">\'!./src/css/**/*.dev.js\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./build/js\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// Copy all files from images directory to images build directory after clean task</span>\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'images-copy\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'clean\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'./src/images/*.*\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./build/images\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// Copy all html files to html build directory after clean task</span>\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'html-copy\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'clean\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'./src/*.html\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./build\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// Default task for execute all tasks in single one</span>\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'clean\'</span><span class="token punctuation">,</span> <span class="token string">\'css-copy\'</span><span class="token punctuation">,</span> <span class="token string">\'js-copy\'</span><span class="token punctuation">,</span> <span class="token string">\'images-copy\'</span><span class="token punctuation">,</span> <span class="token string">\'html-copy\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>Теперь запустив команду</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code>gulp\n</code></pre>\n      </div>\n<p>проект будет полностью собран в директорию сборки.</p>',color:"rgba(150, 61, 60, 0.8)",title:"Hello World. Gulp",description:"Hello World. Gulp",category:"кодинг",tags:["hello world","javascript","node js","gulp"],date:"2016-09-11T00:00:00.000Z",type:null},{images:{blurUp:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAA/ElEQVQoz62QvWvCUBTF/atLuxaHIhShgzgoDlKH6uDQTVwEXQxVa2tUEjVGkxg/UqMmxpic3jxQkWziWd7h8t7vnvMiuLMiJ3P0PYjb5U2Q/mYRBpZ0AcOdQWAfD/URXttTrPYunjgJ0aaMjrHD26+CwnCBl9YEjzT/HK/Y29SICwOLSgfGwWL+uSEj9j2FZjnMVzWTgBbiPwoq6ho+LU33ZuwM9DFpY+s618CyLkK1TeaTXQ1JXsPB85DuzyCYNrj5Bn+OiwSvsjsB8KSc3DrDz0De1FFbjlnlPNXiKZGwtvEu6MiJc0pwRJZ8kHRAC4rS5b8z0le48r30D7DuFKOmFdvEAAAAAElFTkSuQmCC"},share:{src:"/static/rest-api-0211be6ff0f879d0d8481d9480297691-f5537.jpg"},heroPreviewLG:{src:"/static/rest-api-0211be6ff0f879d0d8481d9480297691-294b1.webp"},heroPreviewMD:{src:"/static/rest-api-0211be6ff0f879d0d8481d9480297691-d8cc9.webp"},heroPreviewSM:{src:"/static/rest-api-0211be6ff0f879d0d8481d9480297691-c14dc.webp"},heroPreviewXS:{src:"/static/rest-api-0211be6ff0f879d0d8481d9480297691-227ee.webp"},mediumPreview:{src:"/static/rest-api-0211be6ff0f879d0d8481d9480297691-ce211.webp"},smallPreview:{src:"/static/rest-api-0211be6ff0f879d0d8481d9480297691-051c1.webp"}},excerpt:"Ave $USER! Спроектировать Rest API для мобильного приложения, SPA( Single Page Application ) или просто как отдельного сервиса…",id:"/Users/ivan/projects/gatsby-blog/src/pages/2016/12/article-rest-api-design-best-practices/index.md absPath of file >>> MarkdownRemark",slug:"/2016/12/article-rest-api-design-best-practices",permalink:"https://potofcode.com/2016/12/article-rest-api-design-best-practices/",html:'<p>Ave $USER!</p>\n<p>Спроектировать Rest API для мобильного приложения, SPA( Single Page Application ) или просто как отдельного сервиса не так уж и просто.\nС учетом моделей данных и особенностей архитектуры стэка, на котором он будет запущен этот процесс становится еще сложнее.\nА если еще добавить аутентификацию пользователя, через авторизацию на стороннем сервисе, то процесс проектирования может очень сильно затянуться.\nЧто бы не потеряться во всем этом, я составил небольшой список лучших практик проектирования Rest API с подробными объяснениями.</p>\n<h2>Содержание:</h2>\n<ol class="contents">\n  <li><a href="#Определения">Определения</a></li>\n  <li><a href="#Проектирование схемы">Проектирование схемы</a></li>\n  <li><a href="#Конечные адреса">Конечные адреса</a></li>\n  <li><a href="#Документация">Документация</a></li>\n  <li><a href="#Шифрование">Шифрование</a></li>\n</ol>\n<h3><a name="Определения">Определения</a></h3>\n<p>Сначала дадим некоторые определения и понятия, которые я буду использовать далее:</p>\n<ul>\n<li>Ресурс (Resource) - Экземпляр одиночного объекта. Например: товар</li>\n<li>Коллекция (Collection) - Коллекция однотипных объектов. Например: товар</li>\n<li>Схема (Schema) - Описание модели объекта или коллекции объектов. Например: для товара схема описывает название, цену,\nтип, количество на складе, список свойств товара и т.д.</li>\n<li>Конечный адрес (Endpoint) - URL который представляет ресурс или коллекцию</li>\n</ul>\n<h3><a name="Проектирование схемы">Проектирование схемы</a></h3>\n<p>На самом деле, проектирование Rest API начинается гораздо раньше чем вы можете подумать.\nПроектирование начинается со схемы ресурсов и коллекций и их связей. Например вы проектируете социальную сеть Switter.\nБазовые сущности социальной сети - это профили пользователей <code>Profile</code>.\nМежду профилями существуют связи в виде дружбы типа многие ко многим и разрешается она через вспомогательную схему <code>Friends</code>.\nВнутри социальной сети можно обмениваться сообщениями <code>Message</code>.\nСообщение имеет отправителя и один или несколько адресатов.\nВсе участники беседы <code>Profiles</code> объединяются в <code>MessageGroups</code> через <code>ProfilesMessageGroups</code>,\nи каждое сообщение <code>Messages</code> имеет свою <code>MessageGroups</code>. Визуально это выглядит так:</p>\n<div class="presentation">\n  \n  <a class="gatsby-resp-image-link" href="/static/schema-9bc7c46bbf25b62e8033538c4560291a-3f470.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; z-index: 1; max-width: 601px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 88.85191347753744%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsSAAALEgHS3X78AAAB60lEQVQ4y5WT64vTQBTF+/9/FEQQBREREVlZ8IVCxbXuupvtkjSbx8QkTF6TTl5tmqRt0ke8zaypQiLsYVpKM785d869GdR1vd3uxr/oGa9xun+DI82L6i7pJD05E14Puc8CrjZb+GcAn7Kqrm6VcwHdYorIHNN5J5zEM1m3RM1E2Kuq6g7ebDazNJ1Op2EY0kZ5ni8bFUXR/ogp9X0ftmVZBsgdDMcgTZtMJqIo8jwvy3ILr1YrZrvf7z1C4CnHcbCtLMsjLEkSxjhoBP5tqeDQOjuOo+s62MLRx7J3u70VpAr24RvZNJjnTRDbYl2xVTbxWIReiehGNSXTO5bNBMcfmKYe0Ei0n338+fTd6OTS+KE4nRH2wsksME1zvV6z4u8HZ4uF67qQ/D1giBd4iMS2LEVREEKqqkKWEFj5R2xnB9xK0zRogd0ISvj7UVtdLxzHMBSUTU7b7V4YGviPM3YveGUs69Abw/G7YQknr4bj5x++Pzn9+uLT+csvl9c6qf8ruD8M3AGOolg1LGTaSb5ia5YVfdi1Rh+djh68GT58++3x+4tB6BMIRhAEmFhoLFzSsiy4wrJLSexDeGw2D86wFd4Elg0TjHefMyGEvT/QP7AcuNOQV3TFsGGZXhCmy2TRW3Y0zw0St+s34fP3nEuR8kQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;" alt="schema" title="" src="/static/schema-9bc7c46bbf25b62e8033538c4560291a-3f470.png" srcset="/static/schema-9bc7c46bbf25b62e8033538c4560291a-2efde.png 245w,\n/static/schema-9bc7c46bbf25b62e8033538c4560291a-821bc.png 490w,\n/static/schema-9bc7c46bbf25b62e8033538c4560291a-3f470.png 601w" sizes="(max-width: 601px) 100vw, 601px">\n    </span>\n  </span>\n  \n  </a>\n    \n</div>\n<p><a href="/model-a5400ffd621c3c5c781102159c7a0b12.mwb">Скачать проект MySQL Workbench</a></p>\n<p>Из схемы видно, что два профиля дружат, если в <code>Friend</code> существует запись в обе стороны с подтверждением.\nАналогично легко получить список переписок и всех участников каждой переписки и их сообщения.</p>\n<p>Таким образом, перед проектирование Rest API необходимо определить схемы всех сущностей вашего приложения.</p>\n<h3><a name="Конечные адреса">Конечные адреса</a></h3>\n<p>Есть несколько общепринятых правил составления конечных адресов.</p>\n<h4><a name="Никаких глаголов в конечных адресах">1. Никаких глаголов в конечных адресах</a></h4>\n<p>Все возможные действия в Rest API выполняются с помощью HTTP методов:</p>\n<ul>\n<li>GET - получить</li>\n<li>POST - создать</li>\n<li>PUT - заменить</li>\n<li>PATCH - частично изменить</li>\n<li>DELETE - удалить</li>\n</ul>\n<p>Отсюда видно, что никаких изменений данных при GET запросе не должно происходить.</p>\n<h4><a name="Только существительные во множественном числе">2. Только существительные во множественном числе</a></h4>\n<p>Не стоит смешивать единственное и множественное число ресурсов, это нарушает семантическое значение и может ввести в заблуждение.\nИспользуйте всегда множественное. Например у вас есть ресурс <code>users</code>,\nзайдя на него по конечному адресу <code>/api/v1/users</code> вы получите список пользователей, естественно ограниченный фильтрами по умолчанию,\nкак если бы вы зашли по адресу <code>/api/v1/users?offset=0&#x26;limit=50</code>.\nНо перейдя на адрес <code>/api/v1/users/1</code> мы как бы говорим: “получить объект с id=1 из ресурса пользователи”</p>\n<h4><a name="Используйте подзапросы в ресурсах с отношениями">3. Используйте подзапросы в ресурсах с отношениями</a></h4>\n<p>Если мы хотим получить друзей пользователя под номером 1, то адрес будет следующим <code>/api/v1/users/1/friends</code>.\nЭтот подход позволяет избежать дополнительных запросов на сервер.</p>\n<h4><a name="Используйте HTTP заголовки для сообщения об ожидемом формате ответа">4. Используйте HTTP заголовки для сообщения об ожидемом формате ответа</a></h4>\n<p>И клиент и сервер должны знать в каком формате общаться и этот формат должен быть предоставлен в HTTP заголовке.</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code>Content-Type - формат запроса\nAccept - список поддерживаемых форматов для ответа</code></pre>\n      </div>\n<p>Постарайтесь избежать использование формата в URL</p>\n<h4><a name="Используйте HATEOAS">5. Используйте HATEOAS</a></h4>\n<p>HATEOAS - это Hypermedia as the Engine of Application State,\nчто по сути это метаинформация о структуре вашего сервиса, которая может быть использована для автоматического исследования (service autodiscover).\nЧто дает возможность некоторым приложениям без человеческого вмешательства исследовать ваш сервис.\nНапример имеем ответ от сервера с адреса <code>/api/v1/users/1</code>:</p>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code><span class="token punctuation">{</span>\n    <span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"Ivan"</span><span class="token punctuation">,</span>\n    <span class="token property">"lastName"</span><span class="token operator">:</span> <span class="token string">"Ivanov"</span><span class="token punctuation">,</span>\n    <span class="token property">"autodiscover"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"friends"</span><span class="token operator">:</span> <span class="token string">"`/api/v1/users/1/friends"</span><span class="token punctuation">,</span>\n        <span class="token property">"photos"</span><span class="token operator">:</span> <span class="token string">"`/api/v1/users/1/photos"</span><span class="token punctuation">,</span>\n        <span class="token property">"messages"</span><span class="token operator">:</span> <span class="token string">"`/api/v1/users/1/messages"</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>в секции <code>autodiscover</code> мы видим список ресурсов, которые относятся к текущему.</p>\n<h4><a name="Предоставьте возможности фильтрации, сортировки, выбора полей, ограничения и смещения записей для колекций">6. Предоставьте возможности фильтрации, сортировки, выбора полей, ограничения и смещения записей для колекций</a></h4>\n<p>Для таких целей, лучше поддерживать какой-нибудь язык запросов, позволяющий расширить стандартный, например graphql.\nЯ же приведу примеры на псевдоязыке:</p>\n<ul>\n<li>Фильтрация - Поддерживайте фильтрацию с выражениями <code>/api/v1/users?filter=(firstName=\'Ivan\',lastName=/^Ivan/,age>=18)</code></li>\n<li>Сортировка - Поддерживайте сортировку по возрастанию и убыванию для нескольких полей <code>/api/v1/users?sort=(firstName:1,DOB:0)</code></li>\n<li>Выбор полей - Поддерживайте выбор полей, это не только уменьшит трафик, но и позволит быстрее работать клиенту, обрабатывая меньшее количество данных\n<code>/api/v1/users?fields=[firstName, lastName, DOB]</code></li>\n<li>Ограничение и смещение - Поддерживайте параметры limit и offset, для контроля количества отдаваемых сущностей,\nтак же это более гибкий подход, чем постраничный <code>/api/v1/users?offset=20&#x26;limit=10</code></li>\n</ul>\n<h4><a name="Поддерживайте версионность API">7. Поддерживайте версионность API</a></h4>\n<p>Время от времени, стандарты и интерфейсы вашего API могут меняться и что бы избежать путаницы используйте версионность.\nИзбегайте API без версий или API с дробными значениями <code>/api/v100500/users</code></p>\n<h4><a name="Обрабатывайте ошибки по HTTP кодам">8. Обрабатывайте ошибки по HTTP кодам</a></h4>\n<p>Протокол HTTP поддерживает огромное количество <a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2_%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_HTTP">кодов состояний</a>\nНе обязательно использовать их все, достаточно этих 13:</p>\n<ul>\n<li>200 – OK – ответ отправлен успешно, обычно ответ на: GET</li>\n<li>201 – Created – создание успешно завершено, обычно ответ на: POST, PUT</li>\n<li>204 – Accepted – удаление или редактирование успешно завершено, обыно ответ на: PATCH, DELETE</li>\n<li>205 – Reset Content – после выполнения операции необходимо обновить данные</li>\n<li>304 – Not Modified – ничего не изменилось, можно взять данные из кэша приложения</li>\n<li>400 – Bad Request – неправильный запрос, подробности обыно предоставляют в теле ответа</li>\n<li>401 – Unauthorized – пользователь не авторизован</li>\n<li>402 – Payment Required – пользователю необходимо произвести оплату для продолжения</li>\n<li>403 – Forbidden – пользователь авторизован, но не имеет привиллегий для выполнения операции</li>\n<li>404 – Not found – ресурс не найден</li>\n<li>415 – Unsupported Media Type – например, если пользователь загружает текстовый файл вместо ожидаемой картинки</li>\n<li>500 – Internal Server Error – этот код лучше не использовать, но записывать в логи все данные об ошибке</li>\n<li>501 – Not implemented – используется для сообщения, что данная операция не реализована на сервере, например если ваше приложение в стадии активной разработки</li>\n</ul>\n<p>При ответе об ошибки помещайте дополнительную информацию в тело запроса (payload - полезная нагрузка)</p>\n<h4><a name="Поддерживайте переопределение HTTP методов">9. Поддерживайте переопределение HTTP методов</a></h4>\n<p>Достаточно редкий случай, но некоторые прокси серверы поддерживают только GET и POST запросы.\nВ таком случае можно реализовать служебный заголовок <code>X-HTTP-Method-Override</code>, для замены POST метода на метод указанный в нем.</p>\n<h3><a name="Документация">4. Документация</a></h4>\n<p>Какой бы user-friendly не был ваш API он обязательно должен быть документирован, от схем до значений HTTP кодов.\nСуществуют множество способов документирования API, наиболее популярный и на мой взляд понятный - это <a href="http://swagger.io">swagger</a>,\nко всему у них можно найти спецификацию Rest API (стандарт, которому они следуют).</p>\n<h3><a name="Шифрование">5. Шифрование</a></h4>\n<p>Старайтесь использовать SSL шифрование. Сертификаты легко и бесплатно можно получить на <a href="https://www.startssl.com/">StartSLL</a> или <a href="https://letsencrypt.org/">LetsEncrypt</a>.</p>',color:"rgba(37, 127, 110, 0.8)",title:"Проектирование Rest API",description:"Как спроектировать Rest API для мобильного приложения или SPA",category:"кодинг",tags:["rest","api"],date:"2016-12-11T00:00:00.000Z",type:null}]}}}});
//# sourceMappingURL=path---2016-09-hello-world-github-pages-4c6454807d674c21fada.js.map